%% Compute compressor power & cooling capacity from csv coeffs
%2.3e+04max 15
%0.76e+03  min 0.08 3.9e+03
% For compressor nominal parameter  0.11 6.7911e+03
clc;
% rating point
S = 5;       % evap sat temp [°C]
D = 50;      % cond sat temp [°C]
R = 9.0392e+03;    % speed [1/min]  

%% Power coefficients (kW)
CP = [ ...
  0.246108, ...    % C0
 -0.00743,  ...    % C1
 -0.01097,  ...    % C2
 -2.7e-05, ...     % C3
  0.000241, ...    % C4
 -1e-05,   ...     % C5
  1.19e-05, ...    % C6
 -0.00055, ...     % C7
  0.00038,  ...    % C8
  3.19e-08, ...    % C9
  1.77e-07, ...    % C10
  9.01e-06, ...    % C11
 -1.1e-07, ...     % C12
 -6.8e-06, ...     % C13
 -4.6e-07, ...     % C14
  5.42e-08, ...    % C15
 -2.9e-06, ...     % C16
  7.4e-10, ...     % C17
 -5.6e-10, ...     % C18
  1.88e-12  ...    % C19
];

P = CP(1) ...
  + CP(2)*S ...
  + CP(3)*D ...
  + CP(4)*R ...
  + CP(5)*S*D ...
  + CP(6)*S*R ...
  + CP(7)*D*R ...
  + CP(8)*S^2 ...
  + CP(9)*D^2 ...
  + CP(10)*R^2 ...
  + CP(11)*S*D*R ...
  + CP(12)*S^2*D ...
  + CP(13)*S^2*R ...
  + CP(14)*S^3 ...
  + CP(15)*S*D^2 ...
  + CP(16)*D^2*R ...
  + CP(17)*D^3 ...
  + CP(18)*S*R^2 ...
  + CP(19)*D*R^2 ...
  + CP(20)*R^3;   % kW

disp(['Power map P = ', num2str(P), ' kW']);

%% Cooling capacity coefficients (kW)
CQ = [ ...
 -0.2126701518, ...       % C0
  0.008527431727, ...     % C1
  0.03792721029, ...      % C2
  0.002935948494, ...     % C3
 -0.001359847855, ...     % C4
  0.0001240433239, ...    % C5
 -0.00001240255034, ...   % C6
  0.0002265104189, ...    % C7
 -0.001224994458, ...     % C8
  0.0000001176133245, ... % C9
 -0.000001128909362, ...  % C10
 -0.00009566291471, ...   % C11
  0.000001776932529, ...  % C12
  0.00007886634132, ...   % C13
  0.00005035137852, ...   % C14
 -0.0000001905854801, ... % C15
  0.00001130022785, ...   % C16
  0.00000000138695956, ...% C17
  0.00000000113789233, ...% C18
  0                       % C19
];

Q = CQ(1) ...
  + CQ(2)*S ...
  + CQ(3)*D ...
  + CQ(4)*R ...
  + CQ(5)*S*D ...
  + CQ(6)*S*R ...
  + CQ(7)*D*R ...
  + CQ(8)*S^2 ...
  + CQ(9)*D^2 ...
  + CQ(10)*R^2 ...
  + CQ(11)*S*D*R ...
  + CQ(12)*S^2*D ...
  + CQ(13)*S^2*R ...
  + CQ(14)*S^3 ...
  + CQ(15)*S*D^2 ...
  + CQ(16)*D^2*R ...
  + CQ(17)*D^3 ...
  + CQ(18)*S*R^2 ...
  + CQ(19)*D*R^2 ...
  + CQ(20)*R^3;   % kW

disp(['Cooling capacity Q = ', num2str(Q), ' kW']);
disp(['Cooling capacity Q = ', num2str(Q*0.284345), ' tons']);

tonnage = 0.8;
Q_target = tonnage * 3.517; % kW (4 ton)11
f = @(R) ( ...
  CQ(1) + CQ(2)*S + CQ(3)*D + CQ(4)*R + CQ(5)*S*D + CQ(6)*S*R + CQ(7)*D*R + ...
  CQ(8)*S^2 + CQ(9)*D^2 + CQ(10)*R.^2 + CQ(11)*S*D*R + CQ(12)*S^2*D + CQ(13)*S^2*R + ...
  CQ(14)*S^3 + CQ(15)*S*D^2 + CQ(16)*D^2*R + CQ(17)*D^3 + CQ(18)*S*R.^2 + CQ(19)*D*R.^2 + CQ(20)*R.^3 ...
) - Q_target;

R_guess = 4500;              % rpm initial guess
R_needed = fzero(f, R_guess);
disp(R_needed);
disp(R_needed/60);